<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área do Aluno - Instituto Educar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --dark: #0f172a;
            --dark-lighter: #1e293b;
        }
        body { font-family: 'Manrope', sans-serif; background: var(--dark); color: #f1f5f9; overflow-x: hidden; }
        .bebas { font-family: 'Bebas Neue', sans-serif; }
        
        .animated-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        .grid-pattern {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(99, 102, 241, 0.05) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
            background-size: 40px 40px; opacity: 0.3;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
        }
        .glass-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #fbbf24); width: 65%; }
    </style>
</head>
<body class="min-h-screen">

    <div class="animated-bg"></div>
    <div class="grid-pattern"></div>

    <nav class="glass-card sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-indigo-500/20">
        <div class="flex items-center gap-4">
            <span class="bebas text-2xl tracking-widest text-indigo-400">INSTITUTO EDUCAR</span>
        </div>
        <div class="flex items-center gap-6">
            <div class="text-right hidden md:block">
                <p class="text-xs text-slate-400 font-bold uppercase tracking-tighter">Status: Ativo</p>
                <p class="text-sm font-bold" id="alunoNome">ALUNO_TESTE_01</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-amber-500 p-0.5">
                <div class="w-full h-full rounded-full bg-slate-900 flex items-center justify-center font-bold" id="alunoAvatar">A</div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6 md:p-8">
        <header class="mb-10">
            <h1 class="bebas text-5xl text-white tracking-wider mb-2">BEM-VINDO AO <span class="text-amber-400">CENTRO DE COMANDO</span></h1>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="glass-card p-6 rounded-2xl">
                <p class="text-slate-400 text-xs font-bold uppercase mb-2">Progresso Total</p>
                <div class="flex items-end justify-between mb-4">
                    <span class="text-4xl font-black" id="progressoPercent">0%</span>
                    <span class="text-indigo-400 text-xs font-mono" id="progressoCount">0/18 Aulas</span>
                </div>
            </div>
            <div class="glass-card p-6 rounded-2xl border-l-4 border-amber-500">
                <p class="text-slate-400 text-xs font-bold uppercase mb-2">Próxima Aula</p>
                <h3 class="font-bold text-lg mb-1" id="proximaAula">Aula Teste</h3>
                <p class="text-xs text-slate-500">Módulo 01 • 45 min</p>
            </div>
            <div class="glass-card p-6 rounded-2xl border-l-4 border-emerald-500">
                <p class="text-slate-400 text-xs font-bold uppercase mb-2">Certificados</p>
                <h3 class="font-bold text-lg mb-1">02 Disponíveis</h3>
                <a href="#" class="text-xs text-emerald-400 underline uppercase font-bold tracking-widest">Baixar agora</a>
            </div>
        </div>

        <h2 class="bebas text-3xl mb-6 tracking-wide">Meus Treinamentos</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="glass-card rounded-3xl overflow-hidden group">
                <div class="h-40 bg-slate-800 relative">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent"></div>
                    <img src="https://images.unsplash.com/photo-1587620962725-abab7fe55159?auto=format&fit=crop&w=400" class="w-full h-full object-cover opacity-50 group-hover:scale-105 transition-transform duration-500" alt="Curso">
                    <span class="absolute top-4 left-4 bg-indigo-600 text-[10px] px-2 py-1 rounded font-bold uppercase">Tecnologia</span>
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl mb-2">Teste</h3>
                    <p class="text-slate-400 text-sm mb-6 line-clamp-2">Descrição teste.</p>
                    <a href="" class="block w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-center rounded-xl font-bold transition-all">Continuar Aula</a>
                </div>
            </div>

            <div class="glass-card rounded-3xl overflow-hidden opacity-80">
                <div class="h-40 bg-slate-800 relative grayscale">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="bebas text-2xl text-slate-500 tracking-widest">EM BREVE</span>
                    </div>
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-xl mb-2 text-slate-500">Aula em breve teste</h3>
                    <div class="h-10"></div>
                    <button disabled class="w-full py-3 bg-slate-800 text-slate-600 rounded-xl font-bold cursor-not-allowed">Bloqueado</button>
                </div>
            </div>
        </div>
    </main>
    <script>
        (function(){
        function decodeJwtPayload(token) {
            try {
            const payloadBase64 = token.split('.')[1];
            const base64 = payloadBase64.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(escape(window.atob(base64)));
            return JSON.parse(jsonPayload);
            } catch (err) {
            console.error('decodeJwtPayload error', err);
            return null;
            }
        }

        try {
            const token = localStorage.getItem('edu_token');
            const userRaw = localStorage.getItem('edu_user');
            let user = userRaw ? JSON.parse(userRaw) : null;

            if (!token && !user) {
            window.location.replace(`${window.location.origin}/index.html`);
            return;
            }

            if (token && !user) {
            const claims = decodeJwtPayload(token);
            user = {
                email: claims?.email ?? null,
                role: claims?.role ?? claims?.cargo ?? null,
                name: claims?.nome ?? null
            };
            localStorage.setItem('edu_user', JSON.stringify(user));
            }

            const role = (user?.role || '').toLowerCase();
            if (!(role === 'estudante' || role === 'aluno' || role === 'user')) {
            console.warn('Role inválida para aluno:', user?.role);
            window.location.replace(`${window.location.origin}/index.html`);
            return;
            }

            const nomeEl = document.getElementById('alunoNome');
            const avatarEl = document.getElementById('alunoAvatar');
            if (nomeEl) nomeEl.textContent = user.name || user.email || 'Aluno';
            if (avatarEl) avatarEl.textContent = (user.name || user.email || 'A').charAt(0).toUpperCase();

        } catch (err) {
            console.error('erro init aluno:', err);
            window.location.replace(`${window.location.origin}/index.html`);
        }
        })();
    </script>
</body>
</html>